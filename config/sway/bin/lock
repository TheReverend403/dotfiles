#!/bin/sh
set -eu

SCREEN_OFF_TIMER=10
BLUR_TYPE="0x6"
SCREENSHOT_TEMP_PATH="${XDG_RUNTIME_DIR}/lockscreen.png"

grimshot save output - | convert - -blur "${BLUR_TYPE}" "${SCREENSHOT_TEMP_PATH}"

swayidle \
    timeout "${SCREEN_OFF_TIMER}" 'swaymsg "output * dpms off"' \
    resume 'swaymsg "output * dpms on"' &
SWAY_IDLE_PID=$!

swaylock \
    --no-unlock-indicator \
    --image "${SCREENSHOT_TEMP_PATH}"

kill $SWAY_IDLE_PID
